<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>aranoz</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="#"> <img src="img/logo.png" alt="logo"> </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>



                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">


                                <li class="nav-item dropdown">
                                    <a class="nav-link" href="/" id="navbarDropdown_1" role="button">
                                        Home
                                    </a>

                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link" href="/shop" id="navbarDropdown_1" role="button">
                                        Shop
                                    </a>

                                </li>
                                <!-- data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" -->
                                <!-- <% if(locals.user) { %>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link " href="/logout" id="navbarDropdown_3" role="button">
                                            logout
                                        </a>

                                    </li>

                                    <% }else { %>
                                        <li class="nav-item dropdown">
                                            <a class="nav-link " href="/login" id="navbarDropdown_3" role="button">
                                                login
                                            </a>

                                        </li>

                                        <% } %> -->

                                            <li class="nav-item dropdown">
                                                <a class="nav-link " href="/profile" id="navbarDropdown_2"
                                                    role="button">
                                                    Profile
                                                </a>

                                            </li>


                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">
                            <!-- <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a> -->
                            <a href="/wishlistLoad"><i class="ti-heart"></i></a>
                            <div class="dropdown ">
                                <a class="dropdown" href="/cart" id="navbarDropdown3" role="button">
                                    <i class="fas fa-cart-plus"></i>
                                </a>
                                <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <div class="single_product">
    
                                    </div>
                                </div> -->

                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <!-- <div class="search_input" id="search_input_box">
            <div class="container ">
                <form class="d-flex justify-content-between search-inner">
                    <input type="text" class="form-control" id="search_input" placeholder="Search Here">
                    <button type="submit" class="btn"></button>
                    <span class="ti-close" id="close_search" title="Close Search"></span>
                </form>
            </div>
        </div> -->
    </header>

    <!--================Home Banner Area =================-->
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>Cart Products</h2>
                            <p>Home <span>-</span>Cart Products</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    <!--================Cart Area =================-->
    <section class="cart_area padding_top">
        <div class="container">
            <div class="cart_inner">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Product</th>
                                <th scope="col">Price</th>
                                <th scope="col"></th>
                                <th scope="col">Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (wishlistItem && wishlistItem.product.length> 0) { %>
                                <% wishlistItem.product.forEach((item)=> { %>
                                    <tr>
                                        <td>
                                            <div class="media">
                                                <div class="d-flex">
                                                    <img src="SharpImage/<%=item.product_id.image[0]%>" alt="img"
                                                        width="100px" height="100px" />
                                                </div>
                                                <div class="media-body">
                                                    <p>
                                                        <%= item.product_id.name %>
                                                    </p>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <h5> $<%= item.product_id.price %>
                                            </h5> <!-- Assuming this is a placeholder -->
                                        </td>
                                        <input type="hidden" id="id" value="<%=id%>">
                                        <td>
                                            <a href="#" class="add_cart"
                                                onclick="addToCart('<%= item.product_id._id %>','<%= item.product_id.name %>','<%= item.product_id.price%>')">
                                                + Add to Cart
                                            </a>
                                        </td>
                                        <td>
                                            <button onclick="deleteFromWishlist('<%= item.product_id._id %>')"
                                                class="btn btn-primary height-auto btn-sm">X</button>
                                        </td>
                                    </tr>
                                    <% }); %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="4">
                                                    <h2>There is no item in the wishlist</h2>
                                                </td>
                                            </tr>
                                            <% } %>
                                            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
                                                <script>

                                                    function addToCart(productId, productName, productPrice) {
                                                       
                                                        let user = document.getElementById("id").value;

                                                        if (!user) {

                                                            Swal.fire({
                                                                icon: 'info',
                                                                title: 'Login Required',
                                                                text: 'Please login to add items to your cart.',
                                                                showCancelButton: true,
                                                                confirmButtonText: 'Login',
                                                                cancelButtonText: 'Cancel',
                                                            }).then((result) => {
                                                                if (result.isConfirmed) {

                                                                    window.location.href = '/login';
                                                                }
                                                            });
                                                            return;



                                                        }

                                                        Swal.fire({
                                                            
                                                            icon: 'question',
                                                            title: 'Add to Cart',
                                                            text: `Do you want to add ${productName} to your cart?`,
                                                            showCancelButton: true,
                                                            confirmButtonText: 'Yes',
                                                            cancelButtonText: 'No',
                                                        }).then((result) => {
                                                            if (result.isConfirmed) {

                                                                console.log("hiii")

                                                                const quantity = 1;
                                                                fetch('/add-to-cart', {
                                                                    method: 'POST',
                                                                    headers: {
                                                                        'Content-Type': 'application/json',
                                                                    },
                                                                    body: JSON.stringify({
                                                                        productId, productName, productPrice, quantity
                                                                    }),
                                                                })
                                                                    .then(response => response.json())
                                                                    .then(data => {
                                                                        if (data.success === false) {
                                                                            Swal.fire({
                                                                                icon: 'info',
                                                                                title: 'Info',
                                                                                text: data.message,
                                                                            });
                                                                        } else {
                                                                            // Handle success response
                                                                            console.log(data.message);
                                                                            // Show success message
                                                                            Swal.fire({
                                                                                icon: 'success',
                                                                                title: 'Added to cart!',
                                                                                text: `${productName} has been added to your cart.`,
                                                                                showConfirmButton: false,
                                                                                timer: 1500
                                                                            });
                                                                        }
                                                                    })


                                                                    .catch(error => {
                                                                        console.error('Error adding to cart:', error);
                                                                        // Show error message
                                                                        Swal.fire({
                                                                            icon: 'error',
                                                                            title: 'Error',
                                                                            text: 'Failed to add the item to the cart. Please try again.',
                                                                        });
                                                                    });
                                                            } else {
                                                                // User clicked "No," do nothing or show a different message
                                                            }
                                                        });
                                                    }

                                                </script>
                                                <script>
                                                    function deleteFromWishlist(productId) {
                                                        $.ajax({
                                                            type: 'POST',
                                                            url: '/deleteWishlist',
                                                            data: { productId: productId },
                                                            success: function (response) {

                                                                window.location.href = '/wishlistLoad';

                                                                console.log(response);
                                                                // You can update the UI here if needed
                                                            },
                                                            error: function (xhr, status, error) {
                                                                // Handle errors
                                                                console.error(error);
                                                            }
                                                        });
                                                    }
                                                </script>
                        </tbody>
                    </table>

                </div>
    </section>
    <!--================End Cart Area =================-->
    <%- include('../user/layouts/footer') %>